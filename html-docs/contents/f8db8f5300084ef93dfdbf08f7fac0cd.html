<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>reachabilityFence</title>
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic|Source+Code+Pro:300,400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="../assets/css/bootstrap.css">
<link rel="stylesheet" href="../assets/css/jquery.bonsai.css">
<link rel="stylesheet" href="../assets/css/main.css">
<link rel="stylesheet" href="../assets/icon-font/icons.css">
<script type="text/javascript" src="../assets/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript" src="../assets/js/bootstrap.js"></script>
<script type="text/javascript" src="../assets/js/jquery.bonsai.js"></script>

  </head>
  <body>
    <div>

      <!-- Name Title -->

      <h1>reachabilityFence</h1>

      <!-- Type and Stereotype -->

      <section style="margin-top: .5em;">
        <span class="alert alert-info">
          <span class="node-icon staruml-icon icon-UMLOperation"></span>
          UMLOperation
        </span>
        
      </section>

      <!-- Path -->

      <section style="margin-top: 10px">
        
        
        
          
          <span class="label label-info"><a href='cf9c8b720f3815adeccaf3ef6e48c6c4.html'><span class='node-icon staruml-icon icon-Project'></span>UML</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='da2be80fe6e48fd9d101c1429f49bd58.html'><span class='node-icon staruml-icon icon-UMLModel'></span>openJDK</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='ee78c922cc529ca62752f771c0bb7b9d.html'><span class='node-icon staruml-icon icon-UMLPackage'></span>java</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='a93b2fc56794e246bf26838d14b54f65.html'><span class='node-icon staruml-icon icon-UMLPackage'></span>lang</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='15753887fa8ec49013d3e8f2b4bd5fe3.html'><span class='node-icon staruml-icon icon-UMLPackage'></span>ref</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='f6861f52766947b0a2b5df491838311e.html'><span class='node-icon staruml-icon icon-UMLClass'></span>Reference</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='f8db8f5300084ef93dfdbf08f7fac0cd.html'><span class='node-icon staruml-icon icon-UMLOperation'></span>reachabilityFence</a></span>
        
      </section>

      <!-- Diagram -->

      

      <!-- Description -->

      
      <section>
        <h3>Description</h3>
        <div>
          
            <p>Ensures that the object referenced by the given reference remains
&lt;a href=&quot;package-summary.html#reachability&quot;&gt;&lt;em&gt;strongly reachable&lt;/em&gt;&lt;/a&gt;,
regardless of any prior actions of the program that might otherwise cause
the object to become unreachable; thus, the referenced object is not
reclaimable by garbage collection at least until after the invocation of
this method.  Invocation of this method does not itself initiate garbage
collection or finalization.
&lt;p&gt; This method establishes an ordering for
&lt;a href=&quot;package-summary.html#reachability&quot;&gt;&lt;em&gt;strong reachability&lt;/em&gt;&lt;/a&gt;
with respect to garbage collection.  It controls relations that are
otherwise only implicit in a program -- the reachability conditions
triggering garbage collection.  This method is designed for use in
uncommon situations of premature finalization where using
{@code synchronized} blocks or methods, or using other synchronization
facilities are not possible or do not provide the desired control.  This
method is applicable only when reclamation may have visible effects,
which is possible for objects with finalizers (See Section 12.6
of &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;) that
are implemented in ways that rely on ordering control for
correctness.
@apiNote
Finalization may occur whenever the virtual machine detects that no
reference to an object will ever be stored in the heap: The garbage
collector may reclaim an object even if the fields of that object are
still in use, so long as the object has otherwise become unreachable.
This may have surprising and undesirable effects in cases such as the
following example in which the bookkeeping associated with a class is
managed through array indices.  Here, method {@code action} uses a
{@code reachabilityFence} to ensure that the {@code Resource} object is
not reclaimed before bookkeeping on an associated
{@code ExternalResource} has been performed; in particular here, to
ensure that the array slot holding the {@code ExternalResource} is not
nulled out in method {@link Object#finalize}, which may otherwise run
concurrently.
&lt;pre&gt; {@code
class Resource {
private static ExternalResource[] externalResourceArray = ...
int myIndex;
Resource(...) {
myIndex = ...
externalResourceArray[myIndex] = ...;
...
}
protected void finalize() {
externalResourceArray[myIndex] = null;
...
}
public void action() {
try {
// ...
int i = myIndex;
Resource.update(externalResourceArray[i]);
} finally {
Reference.reachabilityFence(this);
}
}
private static void update(ExternalResource ext) {
ext.status = ...;
}
}}&lt;/pre&gt;
Here, the invocation of {@code reachabilityFence} is nonintuitively
placed &lt;em&gt;after&lt;/em&gt; the call to {@code update}, to ensure that the
array slot is not nulled out by {@link Object#finalize} before the
update, even if the call to {@code action} was the last use of this
object.  This might be the case if, for example a usage in a user program
had the form {@code new Resource().action();} which retains no other
reference to this {@code Resource}.  While probably overkill here,
{@code reachabilityFence} is placed in a {@code finally} block to ensure
that it is invoked across all paths in the method.  In a method with more
complex control paths, you might need further precautions to ensure that
{@code reachabilityFence} is encountered along all of them.
&lt;p&gt; It is sometimes possible to better encapsulate use of
{@code reachabilityFence}.  Continuing the above example, if it were
acceptable for the call to method {@code update} to proceed even if the
finalizer had already executed (nulling out slot), then you could
localize use of {@code reachabilityFence}:
&lt;pre&gt; {@code
public void action2() {
// ...
Resource.update(getExternalResource());
}
private ExternalResource getExternalResource() {
ExternalResource ext = externalResourceArray[myIndex];
Reference.reachabilityFence(this);
return ext;
}}&lt;/pre&gt;
&lt;p&gt; Method {@code reachabilityFence} is not required in constructions
that themselves ensure reachability.  For example, because objects that
are locked cannot, in general, be reclaimed, it would suffice if all
accesses of the object, in all methods of class {@code Resource}
(including {@code finalize}) were enclosed in {@code synchronized (this)}
blocks.  (Further, such blocks must not include infinite loops, or
themselves be unreachable, which fall into the corner case exceptions to
the &quot;in general&quot; disclaimer.)  However, method {@code reachabilityFence}
remains a better option in cases where this approach is not as efficient,
desirable, or possible; for example because it would encounter deadlock.
@param ref the reference. If {@code null}, this method has no effect.
@since 9
@jls 12.6 Finalization of Class Instances</p>
          
        </div>
      </section>
      

      <!-- Specification -->

      

      <!-- Directed Relationship -->

      

      <!-- Undirected Relationship -->

      

      <!-- Classifier -->

      

      <!-- Interface -->

      

      <!-- Component -->

      

      <!-- Node -->

      

      <!-- Actor -->

      

      <!-- Use Case -->

      

      <!-- Template Parameters -->

      

      <!-- Literals -->

      

      <!-- Attributes -->

      

      <!-- Operations -->

      

      <!-- Receptions -->

      

      <!-- Extension Points -->

      

      <!-- Parameters -->

      
      <section>
        <h3>Parameters</h3>
        <table class="table table-striped table-bordered">
          <tr>
            <th>Direction</th>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          
          <tr>
            <td>in</td>
            <td><a href="246b380c5eaed64030bb1ec61de12515.html">ref</a></td>
            <td><a href='9807778a1dc80e44cb00043ed570dba6.html'><span class='node-icon staruml-icon icon-UMLClass'></span>Object</a></td>
            <td></td>
          </tr>
          
          <tr>
            <td>return</td>
            <td><a href="a77cd33fece4b1431f5ec4e9744fbdcc.html">(unnamed)</a></td>
            <td>void</td>
            <td></td>
          </tr>
          
        </table>
      </section>
      

      <!-- Diagrams -->

      
      

      <!-- Behavior -->

      

      <!-- Action -->

      

      <!-- Interaction -->

      

      <!-- CombinedFragment -->

      

      <!-- Activity -->

      

      <!-- State Machine -->

      

      <!-- State Machine -->

      

      <!-- State -->

      

      <!-- Vertex -->

      

      <!-- Transition -->

      

      <!-- Data Model (ERD) -->

      

      <!-- Columns (ERD) -->

      

      <!-- Related Entities (ERD) -->

      

      <!-- Data Flows (DFD) -->

      

      <!-- Flows (Flowchart) -->

      

      <!-- Properties -->

      <section>
        <h3>Properties</h3>
        
        <table class="table table-striped table-bordered">
    <tr>
        <th width="50%">Name</th>
        <th width="50%">Value</th>
    </tr>
    
    
    
    
    
    
    
    <tr>
        <td>name</td>
        <td>reachabilityFence</td>
    </tr>
    
    
    
    
    
    
    
    
    
    
    
    <tr>
        <td>stereotype</td>
        <td><span class='label label-info'>null</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>visibility</td>
        <td>public</td>
    </tr>
    
    
    
    
    
    
    
    <tr>
        <td>isStatic</td>
        <td><span class='label label-info'>true</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>isLeaf</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>parameters</td>
        <td>
            
            
            <a href='246b380c5eaed64030bb1ec61de12515.html'><span class='node-icon staruml-icon icon-UMLParameter'></span>ref</a>
            
            <span>, </span>
            <a href='a77cd33fece4b1431f5ec4e9744fbdcc.html'><span class='node-icon staruml-icon icon-UMLParameter'></span>(Parameter)</a>
            
        </td>
    </tr>
    
    
    
    
    
    <tr>
        <td>raisedExceptions</td>
        <td>
            
        </td>
    </tr>
    
    
    
    
    
    <tr>
        <td>concurrency</td>
        <td>sequential</td>
    </tr>
    
    
    
    
    
    <tr>
        <td>isQuery</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>isAbstract</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>specification</td>
        <td></td>
    </tr>
    
    
    
    
    
    
    
    
    
</table>                

      </section>

      <!-- Tags -->

      

      <!-- Constraints, Dependencies, Dependants -->

      
        
        


        
        


        
        

      

      <!-- Relationships -->

      
      


      <!-- Owned Elements -->

      
      


    </div>
  </body>
</html>
