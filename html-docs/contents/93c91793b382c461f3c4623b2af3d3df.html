<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>ThreadLocalMap</title>
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic|Source+Code+Pro:300,400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="../assets/css/bootstrap.css">
<link rel="stylesheet" href="../assets/css/jquery.bonsai.css">
<link rel="stylesheet" href="../assets/css/main.css">
<link rel="stylesheet" href="../assets/icon-font/icons.css">
<script type="text/javascript" src="../assets/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript" src="../assets/js/bootstrap.js"></script>
<script type="text/javascript" src="../assets/js/jquery.bonsai.js"></script>

  </head>
  <body>
    <div>

      <!-- Name Title -->

      <h1>ThreadLocalMap</h1>

      <!-- Type and Stereotype -->

      <section style="margin-top: .5em;">
        <span class="alert alert-info">
          <span class="node-icon staruml-icon icon-UMLClass"></span>
          UMLClass
        </span>
        
      </section>

      <!-- Path -->

      <section style="margin-top: 10px">
        
        
        
          
          <span class="label label-info"><a href='cf9c8b720f3815adeccaf3ef6e48c6c4.html'><span class='node-icon staruml-icon icon-Project'></span>UML</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='da2be80fe6e48fd9d101c1429f49bd58.html'><span class='node-icon staruml-icon icon-UMLModel'></span>openJDK</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='ee78c922cc529ca62752f771c0bb7b9d.html'><span class='node-icon staruml-icon icon-UMLPackage'></span>java</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='a93b2fc56794e246bf26838d14b54f65.html'><span class='node-icon staruml-icon icon-UMLPackage'></span>lang</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='728545bb65336d95aa544c1a71a87a79.html'><span class='node-icon staruml-icon icon-UMLClass'></span>ThreadLocal</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='93c91793b382c461f3c4623b2af3d3df.html'><span class='node-icon staruml-icon icon-UMLClass'></span>ThreadLocalMap</a></span>
        
      </section>

      <!-- Diagram -->

      

      <!-- Description -->

      
      <section>
        <h3>Description</h3>
        <div>
          
            <p>ThreadLocalMap is a customized hash map suitable only for
maintaining thread local values. No operations are exported
outside of the ThreadLocal class. The class is package private to
allow declaration of fields in class Thread.  To help deal with
very large and long-lived usages, the hash table entries use
WeakReferences for keys. However, since reference queues are not
used, stale entries are guaranteed to be removed only when
the table starts running out of space.</p>
          
        </div>
      </section>
      

      <!-- Specification -->

      

      <!-- Directed Relationship -->

      

      <!-- Undirected Relationship -->

      

      <!-- Classifier -->

      
        
        


        
        


        
        


        
        


        
        

      

      <!-- Interface -->

      

      <!-- Component -->

      

      <!-- Node -->

      

      <!-- Actor -->

      

      <!-- Use Case -->

      

      <!-- Template Parameters -->

      

      <!-- Literals -->

      

      <!-- Attributes -->

      
      <section>
        <h3>Attributes</h3>
        <table class="table table-striped table-bordered">
          <tr>
            <th>Visibility</th>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="a4fe6fda67eba89c2839f55547f0e617.html">INITIAL_CAPACITY</a></td>
            <td>int</td>
            <td><p>The initial capacity -- MUST be a power of two.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="e767a30542bf1ac17f8a3f253d829d1b.html">size</a></td>
            <td>int</td>
            <td><p>The number of entries in the table.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="6d3042bf5211e286744f926e65ded453.html">threshold</a></td>
            <td>int</td>
            <td><p>The next size value at which to resize.</p></td>
          </tr>
          
        </table>
      </section>
      

      <!-- Operations -->

      
      <section>
        <h3>Operations</h3>
        <table class="table table-striped table-bordered">
          <tr>
            <th>Visibility</th>
            <th>Name</th>
            <th>Description</th>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="0efc6fc6c637600ae609d01c30babdb0.html">setThreshold(len: int): void</a></td>
            <td><p>Set the resize threshold to maintain at worst a 2/3 load factor.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="323302b43bb881abc81a508fa91a5544.html">nextIndex(i: int, len: int): int</a></td>
            <td><p>Increment i modulo len.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="f0eeadf945a9f220f35dba6f1bc05c78.html">prevIndex(i: int, len: int): int</a></td>
            <td><p>Decrement i modulo len.</p></td>
          </tr>
          
          <tr>
            <td>package</td>
            <td><a href="500655ad3d6ee75f6b726a4e2b827b13.html">ThreadLocalMap(firstKey: ThreadLocal, firstValue: Object)</a></td>
            <td><p>Construct a new map initially containing (firstKey, firstValue).
ThreadLocalMaps are constructed lazily, so we only create
one when we have at least one entry to put in it.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="d928529325c36e7ded936c234ef861a9.html">ThreadLocalMap(parentMap: ThreadLocalMap)</a></td>
            <td><p>Construct a new map including all Inheritable ThreadLocals
from given parent map. Called only by createInheritedMap.
@param parentMap the map associated with parent thread.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="a57fd7e5b6362ce3bd49025cac355270.html">getEntry(key: ThreadLocal): Entry</a></td>
            <td><p>Get the entry associated with key.  This method
itself handles only the fast path: a direct hit of existing
key. It otherwise relays to getEntryAfterMiss.  This is
designed to maximize performance for direct hits, in part
by making this method readily inlinable.
@param  key the thread local object
@return the entry associated with key, or null if no such</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="57c118d5ea922da920303c7ab8e4b557.html">getEntryAfterMiss(key: ThreadLocal, i: int, e: Entry): Entry</a></td>
            <td><p>Version of getEntry method for use when key is not found in
its direct hash slot.
@param  key the thread local object
@param  i the table index for key&#39;s hash code
@param  e the entry at table[i]
@return the entry associated with key, or null if no such</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="609a6e971072cccae1411446c4cd9ec4.html">set(key: ThreadLocal, value: Object): void</a></td>
            <td><p>Set the value associated with key.
@param key the thread local object
@param value the value to be set</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="354c8d57a457e80767adaac184719c28.html">remove(key: ThreadLocal): void</a></td>
            <td><p>Remove the entry for key.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="23b9af56a6a7cc75319e897cfd4e7e06.html">replaceStaleEntry(key: ThreadLocal, value: Object, staleSlot: int): void</a></td>
            <td><p>Replace a stale entry encountered during a set operation
with an entry for the specified key.  The value passed in
the value parameter is stored in the entry, whether or not
an entry already exists for the specified key.
As a side effect, this method expunges all stale entries in the
&quot;run&quot; containing the stale entry.  (A run is a sequence of entries
between two null slots.)
@param  key the key
@param  value the value to be associated with key
@param  staleSlot index of the first stale entry encountered while
searching for key.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="aa623ef8a19e543e893f3702f99633af.html">expungeStaleEntry(staleSlot: int): int</a></td>
            <td><p>Expunge a stale entry by rehashing any possibly colliding entries
lying between staleSlot and the next null slot.  This also expunges
any other stale entries encountered before the trailing null.  See
Knuth, Section 6.4
@param staleSlot index of slot known to have null key
@return the index of the next null slot after staleSlot
(all between staleSlot and this slot will have been checked
for expunging).</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="6efea680dcc6df7b60aa35d7f15fbb1f.html">cleanSomeSlots(i: int, n: int): boolean</a></td>
            <td><p>Heuristically scan some cells looking for stale entries.
This is invoked when either a new element is added, or
another stale one has been expunged. It performs a
logarithmic number of scans, as a balance between no
scanning (fast but retains garbage) and a number of scans
proportional to number of elements, that would find all
garbage but would cause some insertions to take O(n) time.
@param i a position known NOT to hold a stale entry. The
scan starts at the element after i.
@param n scan control: {@code log2(n)} cells are scanned,
unless a stale entry is found, in which case
{@code log2(table.length)-1} additional cells are scanned.
When called from insertions, this parameter is the number
of elements, but when from replaceStaleEntry, it is the
table length. (Note: all this could be changed to be either
more or less aggressive by weighting n instead of just
using straight log n. But this version is simple, fast, and
seems to work well.)
@return true if any stale entries have been removed.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="b4313cf5ce1cc91f5283981c22d00552.html">rehash(): void</a></td>
            <td><p>Re-pack and/or re-size the table. First scan the entire
table removing stale entries. If this doesn&#39;t sufficiently
shrink the size of the table, double the table size.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="841feef972637fec80b61c0e41320903.html">resize(): void</a></td>
            <td><p>Double the capacity of the table.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="3a005f1d442f06001835793eac1459a7.html">expungeStaleEntries(): void</a></td>
            <td><p>Expunge all stale entries in the table.</p></td>
          </tr>
          
        </table>
      </section>
      

      <!-- Receptions -->

      

      <!-- Extension Points -->

      

      <!-- Parameters -->

      

      <!-- Diagrams -->

      
      

      <!-- Behavior -->

      

      <!-- Action -->

      

      <!-- Interaction -->

      

      <!-- CombinedFragment -->

      

      <!-- Activity -->

      

      <!-- State Machine -->

      

      <!-- State Machine -->

      

      <!-- State -->

      

      <!-- Vertex -->

      

      <!-- Transition -->

      

      <!-- Data Model (ERD) -->

      

      <!-- Columns (ERD) -->

      

      <!-- Related Entities (ERD) -->

      

      <!-- Data Flows (DFD) -->

      

      <!-- Flows (Flowchart) -->

      

      <!-- Properties -->

      <section>
        <h3>Properties</h3>
        
        <table class="table table-striped table-bordered">
    <tr>
        <th width="50%">Name</th>
        <th width="50%">Value</th>
    </tr>
    
    
    
    
    
    
    
    <tr>
        <td>name</td>
        <td>ThreadLocalMap</td>
    </tr>
    
    
    
    
    
    
    
    
    
    
    
    <tr>
        <td>stereotype</td>
        <td><span class='label label-info'>null</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>visibility</td>
        <td>package</td>
    </tr>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <tr>
        <td>isAbstract</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>isFinalSpecialization</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>isLeaf</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>isActive</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
</table>                

      </section>

      <!-- Tags -->

      

      <!-- Constraints, Dependencies, Dependants -->

      
        
        


        
        


        
        

      

      <!-- Relationships -->

      
      
<section class="element-list">
    <h3>Relationships</h3>
    <ul class="nav nav-list">
        
        <li><a href='926ccb8e0298baa3035b761b66ec906c.html'><span class='node-icon staruml-icon icon-UMLAssociation'></span>(ThreadLocalMap—Entry)</a></li>
        
    </ul>
</section>



      <!-- Owned Elements -->

      
      
<section class="element-list">
    <h3>Owned Elements</h3>
    <ul class="nav nav-list">
        
        <li><a href='a21c16d9d0695920990f0a778534b831.html'><span class='node-icon staruml-icon icon-UMLClass'></span>Entry</a></li>
        
        <li><a href='926ccb8e0298baa3035b761b66ec906c.html'><span class='node-icon staruml-icon icon-UMLAssociation'></span>(ThreadLocalMap—Entry)</a></li>
        
    </ul>
</section>



    </div>
  </body>
</html>
