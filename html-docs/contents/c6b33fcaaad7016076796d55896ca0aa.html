<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>prepare</title>
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic|Source+Code+Pro:300,400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="../assets/css/bootstrap.css">
<link rel="stylesheet" href="../assets/css/jquery.bonsai.css">
<link rel="stylesheet" href="../assets/css/main.css">
<link rel="stylesheet" href="../assets/icon-font/icons.css">
<script type="text/javascript" src="../assets/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript" src="../assets/js/bootstrap.js"></script>
<script type="text/javascript" src="../assets/js/jquery.bonsai.js"></script>

  </head>
  <body>
    <div>

      <!-- Name Title -->

      <h1>prepare</h1>

      <!-- Type and Stereotype -->

      <section style="margin-top: .5em;">
        <span class="alert alert-info">
          <span class="node-icon staruml-icon icon-UMLOperation"></span>
          UMLOperation
        </span>
        
      </section>

      <!-- Path -->

      <section style="margin-top: 10px">
        
        
        
          
          <span class="label label-info"><a href='cf9c8b720f3815adeccaf3ef6e48c6c4.html'><span class='node-icon staruml-icon icon-Project'></span>UML</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='da2be80fe6e48fd9d101c1429f49bd58.html'><span class='node-icon staruml-icon icon-UMLModel'></span>openJDK</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='ee78c922cc529ca62752f771c0bb7b9d.html'><span class='node-icon staruml-icon icon-UMLPackage'></span>java</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='a93b2fc56794e246bf26838d14b54f65.html'><span class='node-icon staruml-icon icon-UMLPackage'></span>lang</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='e4c701803145d5e3dc249c369d7c56bb.html'><span class='node-icon staruml-icon icon-UMLPackage'></span>invoke</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='a48d2b321fb5c60b942f11932466377e.html'><span class='node-icon staruml-icon icon-UMLClass'></span>LambdaForm</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='c6b33fcaaad7016076796d55896ca0aa.html'><span class='node-icon staruml-icon icon-UMLOperation'></span>prepare</a></span>
        
      </section>

      <!-- Diagram -->

      

      <!-- Description -->

      
      <section>
        <h3>Description</h3>
        <div>
          
            <p>Code generation issues:
Compiled LFs should be reusable in general.
The biggest issue is how to decide when to pull a name into
the bytecode, versus loading a reified form from the MH data.
For example, an asType wrapper may require execution of a cast
after a call to a MH.  The target type of the cast can be placed
as a constant in the LF itself.  This will force the cast type
to be compiled into the bytecodes and native code for the MH.
Or, the target type of the cast can be erased in the LF, and
loaded from the MH data.  (Later on, if the MH as a whole is
inlined, the data will flow into the inlined instance of the LF,
as a constant, and the end result will be an optimal cast.)
This erasure of cast types can be done with any use of
reference types.  It can also be done with whole method
handles.  Erasing a method handle might leave behind
LF code that executes correctly for any MH of a given
type, and load the required MH from the enclosing MH&#39;s data.
Or, the erasure might even erase the expected MT.
Also, for direct MHs, the MemberName of the target
could be erased, and loaded from the containing direct MH.
As a simple case, a LF for all int-valued non-static
field getters would perform a cast on its input argument
(to non-constant base type derived from the MemberName)
and load an integer value from the input object
(at a non-constant offset also derived from the MemberName).
Such MN-erased LFs would be inlinable back to optimized
code, whenever a constant enclosing DMH is available
to supply a constant MN from its data.
The main problem here is to keep LFs reasonably generic,
while ensuring that hot spots will inline good instances.
&quot;Reasonably generic&quot; means that we don&#39;t end up with
repeated versions of bytecode or machine code that do
not differ in their optimized form.  Repeated versions
of machine would have the undesirable overheads of
(a) redundant compilation work and (b) extra I$ pressure.
To control repeated versions, we need to be ready to
erase details from LFs and move them into MH data,
whevener those details are not relevant to significant
optimization.  &quot;Significant&quot; means optimization of
code that is actually hot.
Achieving this may require dynamic splitting of MHs, by replacing
a generic LF with a more specialized one, on the same MH,
if (a) the MH is frequently executed and (b) the MH cannot
be inlined into a containing caller, such as an invokedynamic.
Compiled LFs that are no longer used should be GC-able.
If they contain non-BCP references, they should be properly
interlinked with the class loader(s) that their embedded types
depend on.  This probably means that reusable compiled LFs
will be tabulated (indexed) on relevant class loaders,
or else that the tables that cache them will have weak links.
Make this LF directly executable, as part of a MethodHandle.
Invariant:  Every MH which is invoked must prepare its LF
before invocation.
(In principle, the JVM could do this very lazily,
as a sort of pre-invocation linkage step.)</p>
          
        </div>
      </section>
      

      <!-- Specification -->

      

      <!-- Directed Relationship -->

      

      <!-- Undirected Relationship -->

      

      <!-- Classifier -->

      

      <!-- Interface -->

      

      <!-- Component -->

      

      <!-- Node -->

      

      <!-- Actor -->

      

      <!-- Use Case -->

      

      <!-- Template Parameters -->

      

      <!-- Literals -->

      

      <!-- Attributes -->

      

      <!-- Operations -->

      

      <!-- Receptions -->

      

      <!-- Extension Points -->

      

      <!-- Parameters -->

      
      <section>
        <h3>Parameters</h3>
        <table class="table table-striped table-bordered">
          <tr>
            <th>Direction</th>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          
          <tr>
            <td>return</td>
            <td><a href="9d0f03378f649ce8fa4bdc9c6a71c955.html">(unnamed)</a></td>
            <td>void</td>
            <td></td>
          </tr>
          
        </table>
      </section>
      

      <!-- Diagrams -->

      
      

      <!-- Behavior -->

      

      <!-- Action -->

      

      <!-- Interaction -->

      

      <!-- CombinedFragment -->

      

      <!-- Activity -->

      

      <!-- State Machine -->

      

      <!-- State Machine -->

      

      <!-- State -->

      

      <!-- Vertex -->

      

      <!-- Transition -->

      

      <!-- Data Model (ERD) -->

      

      <!-- Columns (ERD) -->

      

      <!-- Related Entities (ERD) -->

      

      <!-- Data Flows (DFD) -->

      

      <!-- Flows (Flowchart) -->

      

      <!-- Properties -->

      <section>
        <h3>Properties</h3>
        
        <table class="table table-striped table-bordered">
    <tr>
        <th width="50%">Name</th>
        <th width="50%">Value</th>
    </tr>
    
    
    
    
    
    
    
    <tr>
        <td>name</td>
        <td>prepare</td>
    </tr>
    
    
    
    
    
    
    
    
    
    
    
    <tr>
        <td>stereotype</td>
        <td><span class='label label-info'>null</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>visibility</td>
        <td>public</td>
    </tr>
    
    
    
    
    
    
    
    <tr>
        <td>isStatic</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>isLeaf</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>parameters</td>
        <td>
            
            
            <a href='9d0f03378f649ce8fa4bdc9c6a71c955.html'><span class='node-icon staruml-icon icon-UMLParameter'></span>(Parameter)</a>
            
        </td>
    </tr>
    
    
    
    
    
    <tr>
        <td>raisedExceptions</td>
        <td>
            
        </td>
    </tr>
    
    
    
    
    
    <tr>
        <td>concurrency</td>
        <td>sequential</td>
    </tr>
    
    
    
    
    
    <tr>
        <td>isQuery</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>isAbstract</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>specification</td>
        <td></td>
    </tr>
    
    
    
    
    
    
    
    
    
</table>                

      </section>

      <!-- Tags -->

      

      <!-- Constraints, Dependencies, Dependants -->

      
        
        


        
        


        
        

      

      <!-- Relationships -->

      
      


      <!-- Owned Elements -->

      
      


    </div>
  </body>
</html>
