<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>ClassValue</title>
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic|Source+Code+Pro:300,400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="../assets/css/bootstrap.css">
<link rel="stylesheet" href="../assets/css/jquery.bonsai.css">
<link rel="stylesheet" href="../assets/css/main.css">
<link rel="stylesheet" href="../assets/icon-font/icons.css">
<script type="text/javascript" src="../assets/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript" src="../assets/js/bootstrap.js"></script>
<script type="text/javascript" src="../assets/js/jquery.bonsai.js"></script>

  </head>
  <body>
    <div>

      <!-- Name Title -->

      <h1>ClassValue</h1>

      <!-- Type and Stereotype -->

      <section style="margin-top: .5em;">
        <span class="alert alert-info">
          <span class="node-icon staruml-icon icon-UMLClass"></span>
          UMLClass
        </span>
        
      </section>

      <!-- Path -->

      <section style="margin-top: 10px">
        
        
        
          
          <span class="label label-info"><a href='cf9c8b720f3815adeccaf3ef6e48c6c4.html'><span class='node-icon staruml-icon icon-Project'></span>UML</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='da2be80fe6e48fd9d101c1429f49bd58.html'><span class='node-icon staruml-icon icon-UMLModel'></span>openJDK</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='ee78c922cc529ca62752f771c0bb7b9d.html'><span class='node-icon staruml-icon icon-UMLPackage'></span>java</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='a93b2fc56794e246bf26838d14b54f65.html'><span class='node-icon staruml-icon icon-UMLPackage'></span>lang</a></span>
        
          <span>::</span>
          <span class="label label-info"><a href='a200517037c3056c049e3a51f3d4b4f7.html'><span class='node-icon staruml-icon icon-UMLClass'></span>ClassValue</a></span>
        
      </section>

      <!-- Diagram -->

      

      <!-- Description -->

      
      <section>
        <h3>Description</h3>
        <div>
          
            <p>Copyright (c) 2010, 2013, Oracle and/or its affiliates. All rights reserved.
DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
This code is free software; you can redistribute it and/or modify it
under the terms of the GNU General Public License version 2 only, as
published by the Free Software Foundation.  Oracle designates this
particular file as subject to the &quot;Classpath&quot; exception as provided
by Oracle in the LICENSE file that accompanied this code.
This code is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
version 2 for more details (a copy is included in the LICENSE file that
accompanied this code).
You should have received a copy of the GNU General Public License version
2 along with this work; if not, write to the Free Software Foundation,
Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
or visit www.oracle.com if you need additional information or have any
questions.
Lazily associate a computed value with (potentially) every type.
For example, if a dynamic language needs to construct a message dispatch
table for each class encountered at a message send call site,
it can use a {@code ClassValue} to cache information needed to
perform the message send quickly, for each class encountered.
@author John Rose, JSR 292 EG
@since 1.7</p>
          
        </div>
      </section>
      

      <!-- Specification -->

      

      <!-- Directed Relationship -->

      

      <!-- Undirected Relationship -->

      

      <!-- Classifier -->

      
        
        


        
        
<section class="element-list">
    <h3>Specialized Elements</h3>
    <ul class="nav nav-list">
        
        <li><a href='8bc880c4e0f0122050ca8a9ae9fb5bfb.html'><span class='node-icon staruml-icon icon-UMLClass'></span>EnsureInitialized</a></li>
        
        <li><a href='3815069c2560d7a96c0888e962f30abb.html'><span class='node-icon staruml-icon icon-UMLClass'></span>StringifierAny</a></li>
        
    </ul>
</section>



        
        


        
        


        
        

      

      <!-- Interface -->

      

      <!-- Component -->

      

      <!-- Node -->

      

      <!-- Actor -->

      

      <!-- Use Case -->

      

      <!-- Template Parameters -->

      
      <section>
        <h3>Template Parameters</h3>
        <table class="table table-striped table-bordered">
          <tr>
            <th>Visibility</th>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          
          <tr>
            <td>public</td>
            <td><a href="0aa02e6be7b10e53f22ea034cef20e12.html">T</a></td>
            <td></td>
            <td></td>
          </tr>
          
        </table>
      </section>
      

      <!-- Literals -->

      

      <!-- Attributes -->

      
      <section>
        <h3>Attributes</h3>
        <table class="table table-striped table-bordered">
          <tr>
            <th>Visibility</th>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          
          <tr>
            <td>package</td>
            <td><a href="15c523b6495bb48ab1da94eb308ea950.html">hashCodeForCache</a></td>
            <td>int</td>
            <td><p>Internal hash code for accessing Class.classValueMap.cacheArray.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="178d284e80f00dba3ab04c071a86fc1a.html">nextHashCode</a></td>
            <td><a href='c8d8220123b629d87dff3667ce713aec.html'>AtomicInteger</a></td>
            <td><p>Value stream for hashCodeForCache.  See similar structure in ThreadLocal.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="a5db513f7e75955de668d86b828e35c1.html">HASH_INCREMENT</a></td>
            <td>int</td>
            <td><p>Good for power-of-two tables.  See similar structure in ThreadLocal.</p></td>
          </tr>
          
          <tr>
            <td>package</td>
            <td><a href="563145e8cde01b5db17edb56c4b14c18.html">HASH_MASK</a></td>
            <td>int</td>
            <td><p>Mask a hash code to be positive but not too large, to prevent wraparound.</p></td>
          </tr>
          
        </table>
      </section>
      

      <!-- Operations -->

      
      <section>
        <h3>Operations</h3>
        <table class="table table-striped table-bordered">
          <tr>
            <th>Visibility</th>
            <th>Name</th>
            <th>Description</th>
          </tr>
          
          <tr>
            <td>protected</td>
            <td><a href="84f67f5a199d7148a95e6a51fac07f3a.html">ClassValue()</a></td>
            <td><p>Sole constructor.  (For invocation by subclass constructors, typically
implicit.)</p></td>
          </tr>
          
          <tr>
            <td>protected</td>
            <td><a href="48c10f358200775d64d29cded916d05a.html">computeValue(type: Class): T</a></td>
            <td><p>Computes the given class&#39;s derived value for this {@code ClassValue}.
&lt;p&gt;
This method will be invoked within the first thread that accesses
the value with the {@link #get get} method.
&lt;p&gt;
Normally, this method is invoked at most once per class,
but it may be invoked again if there has been a call to
{@link #remove remove}.
&lt;p&gt;
If this method throws an exception, the corresponding call to {@code get}
will terminate abnormally with that exception, and no class value will be recorded.
@param type the type whose class value must be computed
@return the newly computed value associated with this {@code ClassValue}, for the given class or interface
@see #get
@see #remove</p></td>
          </tr>
          
          <tr>
            <td>public</td>
            <td><a href="e9d4b914efa46322b0334c7afb7bc27c.html">get(type: Class): T</a></td>
            <td><p>Returns the value for the given class.
If no value has yet been computed, it is obtained by
an invocation of the {@link #computeValue computeValue} method.
&lt;p&gt;
The actual installation of the value on the class
is performed atomically.
At that point, if several racing threads have
computed values, one is chosen, and returned to
all the racing threads.
&lt;p&gt;
The {@code type} parameter is typically a class, but it may be any type,
such as an interface, a primitive type (like {@code int.class}), or {@code void.class}.
&lt;p&gt;
In the absence of {@code remove} calls, a class value has a simple
state diagram:  uninitialized and initialized.
When {@code remove} calls are made,
the rules for value observation are more complex.
See the documentation for {@link #remove remove} for more information.
@param type the type whose class value must be computed or retrieved
@return the current value associated with this {@code ClassValue}, for the given class or interface
@throws NullPointerException if the argument is null
@see #remove
@see #computeValue</p></td>
          </tr>
          
          <tr>
            <td>public</td>
            <td><a href="99abe6b4294819049f704e21d86654b7.html">remove(type: Class): void</a></td>
            <td><p>Removes the associated value for the given class.
If this value is subsequently {@linkplain #get read} for the same class,
its value will be reinitialized by invoking its {@link #computeValue computeValue} method.
This may result in an additional invocation of the
{@code computeValue} method for the given class.
&lt;p&gt;
In order to explain the interaction between {@code get} and {@code remove} calls,
we must model the state transitions of a class value to take into account
the alternation between uninitialized and initialized states.
To do this, number these states sequentially from zero, and note that
uninitialized (or removed) states are numbered with even numbers,
while initialized (or re-initialized) states have odd numbers.
&lt;p&gt;
When a thread {@code T} removes a class value in state {@code 2N},
nothing happens, since the class value is already uninitialized.
Otherwise, the state is advanced atomically to {@code 2N+1}.
&lt;p&gt;
When a thread {@code T} queries a class value in state {@code 2N},
the thread first attempts to initialize the class value to state {@code 2N+1}
by invoking {@code computeValue} and installing the resulting value.
&lt;p&gt;
When {@code T} attempts to install the newly computed value,
if the state is still at {@code 2N}, the class value will be initialized
with the computed value, advancing it to state {@code 2N+1}.
&lt;p&gt;
Otherwise, whether the new state is even or odd,
{@code T} will discard the newly computed value
and retry the {@code get} operation.
&lt;p&gt;
Discarding and retrying is an important proviso,
since otherwise {@code T} could potentially install
a disastrously stale value.  For example:
&lt;ul&gt;
&lt;li&gt;{@code T} calls {@code CV.get(C)} and sees state {@code 2N}
&lt;li&gt;{@code T} quickly computes a time-dependent value {@code V0} and gets ready to install it
&lt;li&gt;{@code T} is hit by an unlucky paging or scheduling event, and goes to sleep for a long time
&lt;li&gt;...meanwhile, {@code T2} also calls {@code CV.get(C)} and sees state {@code 2N}
&lt;li&gt;{@code T2} quickly computes a similar time-dependent value {@code V1} and installs it on {@code CV.get(C)}
&lt;li&gt;{@code T2} (or a third thread) then calls {@code CV.remove(C)}, undoing {@code T2}&#39;s work
&lt;li&gt; the previous actions of {@code T2} are repeated several times
&lt;li&gt; also, the relevant computed values change over time: {@code V1}, {@code V2}, ...
&lt;li&gt;...meanwhile, {@code T} wakes up and attempts to install {@code V0}; &lt;em&gt;this must fail&lt;/em&gt;
&lt;/ul&gt;
We can assume in the above scenario that {@code CV.computeValue} uses locks to properly
observe the time-dependent states as it computes {@code V1}, etc.
This does not remove the threat of a stale value, since there is a window of time
between the return of {@code computeValue} in {@code T} and the installation
of the new value.  No user synchronization is possible during this time.
@param type the type whose class value must be removed
@throws NullPointerException if the argument is null</p></td>
          </tr>
          
          <tr>
            <td>package</td>
            <td><a href="130e145e703a77264cbd1f9edf838050.html">put(type: Class, value: T): void</a></td>
            <td><p>public</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="28fb676a7a6f08e17d841ceef1af4059.html">getCacheCarefully(type: Class): Entry</a></td>
            <td><p>Return the cache, if it exists, else a dummy empty cache.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="2ebc4254d0825768065d63137080f864.html">getFromBackup(cache: Entry, type: Class): T</a></td>
            <td><p>Slow tail of ClassValue.get to retry at nearby locations in the cache,
or take a slow lock and check the hash table.
Called only if the first probe was empty or a collision.
This is a separate method, so compilers can process it independently.</p></td>
          </tr>
          
          <tr>
            <td>package</td>
            <td><a href="29466c7879105a9a4d2898d1a429a4d5.html">castEntry(e: Entry): Entry</a></td>
            <td></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="cbe6c80e8843ce550a91898c50d685c4.html">getFromHashMap(type: Class): T</a></td>
            <td><p>Called when the fast path of get fails, and cache reprobe also fails.</p></td>
          </tr>
          
          <tr>
            <td>package</td>
            <td><a href="443bcb7fb1b0889a7c9dd99fa5d6909f.html">match(e: Entry): boolean</a></td>
            <td><p>Check that e is non-null, matches this ClassValue, and is live.</p></td>
          </tr>
          
          <tr>
            <td>package</td>
            <td><a href="0e3cf95eced5933c5f5c5beba2d54b65.html">version(): Version</a></td>
            <td></td>
          </tr>
          
          <tr>
            <td>package</td>
            <td><a href="51648c382dd7576b22c56b5dd3b4d2f4.html">bumpVersion(): void</a></td>
            <td></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="b40ab4a36f7952319b1fde80d2ce3d4c.html">getMap(type: Class): ClassValueMap</a></td>
            <td><p>Return the backing map associated with this type.</p></td>
          </tr>
          
          <tr>
            <td>private</td>
            <td><a href="e8e0f3b7e9fe8254aa745f9e7f425dc8.html">initializeMap(type: Class): ClassValueMap</a></td>
            <td></td>
          </tr>
          
          <tr>
            <td>package</td>
            <td><a href="f18088a969c3a5979b5a98f02a74f94f.html">makeEntry(explicitVersion: Version, value: T): Entry</a></td>
            <td></td>
          </tr>
          
        </table>
      </section>
      

      <!-- Receptions -->

      

      <!-- Extension Points -->

      

      <!-- Parameters -->

      

      <!-- Diagrams -->

      
      

      <!-- Behavior -->

      

      <!-- Action -->

      

      <!-- Interaction -->

      

      <!-- CombinedFragment -->

      

      <!-- Activity -->

      

      <!-- State Machine -->

      

      <!-- State Machine -->

      

      <!-- State -->

      

      <!-- Vertex -->

      

      <!-- Transition -->

      

      <!-- Data Model (ERD) -->

      

      <!-- Columns (ERD) -->

      

      <!-- Related Entities (ERD) -->

      

      <!-- Data Flows (DFD) -->

      

      <!-- Flows (Flowchart) -->

      

      <!-- Properties -->

      <section>
        <h3>Properties</h3>
        
        <table class="table table-striped table-bordered">
    <tr>
        <th width="50%">Name</th>
        <th width="50%">Value</th>
    </tr>
    
    
    
    
    
    
    
    <tr>
        <td>name</td>
        <td>ClassValue</td>
    </tr>
    
    
    
    
    
    
    
    
    
    
    
    <tr>
        <td>stereotype</td>
        <td><span class='label label-info'>null</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>visibility</td>
        <td>public</td>
    </tr>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <tr>
        <td>isAbstract</td>
        <td><span class='label label-info'>true</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>isFinalSpecialization</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>isLeaf</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
    
    
    <tr>
        <td>isActive</td>
        <td><span class='label label-info'>false</span></td>
    </tr>
    
    
    
</table>                

      </section>

      <!-- Tags -->

      

      <!-- Constraints, Dependencies, Dependants -->

      
        
        


        
        


        
        

      

      <!-- Relationships -->

      
      
<section class="element-list">
    <h3>Relationships</h3>
    <ul class="nav nav-list">
        
        <li><a href='2b192f183a1ebd00bbdbefd9bdd8a17e.html'><span class='node-icon staruml-icon icon-UMLAssociation'></span>(ClassValue—Entry)</a></li>
        
        <li><a href='1700665246f3e0ac4f7d4eba59eb89a5.html'><span class='node-icon staruml-icon icon-UMLAssociation'></span>(ClassValue—Identity)</a></li>
        
        <li><a href='4f28a529802fdf090a94a2f838605742.html'><span class='node-icon staruml-icon icon-UMLAssociation'></span>(ClassValue—Version)</a></li>
        
        <li><a href='eb9c018188befa2ada84c010ae6be368.html'><span class='node-icon staruml-icon icon-UMLAssociation'></span>(ClassValue—Object)</a></li>
        
        <li><a href='445c21db587c73902c5120e82abc6844.html'><span class='node-icon staruml-icon icon-UMLGeneralization'></span>(EnsureInitialized→ClassValue)</a></li>
        
        <li><a href='3ef48b56c723dffb215fcc52ca10e17d.html'><span class='node-icon staruml-icon icon-UMLGeneralization'></span>(StringifierAny→ClassValue)</a></li>
        
        <li><a href='125d82d9cea9a0599b7dbbed9114f06f.html'><span class='node-icon staruml-icon icon-UMLAssociation'></span>(StringifierAny—ClassValue)</a></li>
        
    </ul>
</section>



      <!-- Owned Elements -->

      
      
<section class="element-list">
    <h3>Owned Elements</h3>
    <ul class="nav nav-list">
        
        <li><a href='c82771f761c355c973a163fb642375e3.html'><span class='node-icon staruml-icon icon-UMLClass'></span>Identity</a></li>
        
        <li><a href='908149f5770cccd1d3cab054b4c37023.html'><span class='node-icon staruml-icon icon-UMLClass'></span>Version</a></li>
        
        <li><a href='81faf8f4a9ec645f4a17dfbcc879ad01.html'><span class='node-icon staruml-icon icon-UMLClass'></span>Entry</a></li>
        
        <li><a href='265cd6ba2bed2477ffd0790a06d13ed0.html'><span class='node-icon staruml-icon icon-UMLClass'></span>ClassValueMap</a></li>
        
        <li><a href='2b192f183a1ebd00bbdbefd9bdd8a17e.html'><span class='node-icon staruml-icon icon-UMLAssociation'></span>(ClassValue—Entry)</a></li>
        
        <li><a href='1700665246f3e0ac4f7d4eba59eb89a5.html'><span class='node-icon staruml-icon icon-UMLAssociation'></span>(ClassValue—Identity)</a></li>
        
        <li><a href='4f28a529802fdf090a94a2f838605742.html'><span class='node-icon staruml-icon icon-UMLAssociation'></span>(ClassValue—Version)</a></li>
        
        <li><a href='eb9c018188befa2ada84c010ae6be368.html'><span class='node-icon staruml-icon icon-UMLAssociation'></span>(ClassValue—Object)</a></li>
        
    </ul>
</section>



    </div>
  </body>
</html>
